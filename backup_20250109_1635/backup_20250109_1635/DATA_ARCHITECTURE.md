# Архитектура данных приложения

## Обзор

Данное приложение использует гибридный подход к хранению данных:
- **Локальное хранение (AsyncStorage)** - для временных данных, кэша и оффлайн-режима
- **Серверное хранение (API)** - для постоянных данных пользователей, истории, синхронизации

## Структура хранения данных

### 1. Локальное хранилище (AsyncStorage)

#### Данные авторизации
- `authToken` - JWT токен авторизации
- `isAuthenticated` - флаг авторизации ("true"/"false")
- `userEmail` - email пользователя
- `userId` - уникальный ID пользователя

#### Данные диагностики (временные, очищаются при запуске)
- `diagnosisBlocks` - состояние блоков диагностики
- `actionPlanTasks` - задачи из плана действий
- `questionnaireCompleted` - флаг прохождения анкеты
- `questionnaireData` - данные анкетирования

#### История пользователя (сохраняется)
- `userDiagnosisHistory` - история всех диагностик пользователя

### 2. Серверное хранилище (API)

#### Пользователь
```typescript
interface User {
  id: string;
  email: string;
  fullName?: string;
  phone?: string;
  restaurantName?: string;
  createdAt: string;
  updatedAt?: string;
}
```

#### История диагностики
```typescript
interface DiagnosisHistory {
  id: string;
  userId: string;
  blocks: Block[];
  tasks: Task[];
  efficiency: number;
  createdAt: string;
  updatedAt?: string;
}
```

#### Задачи (синхронизируются с сервером)
```typescript
interface Task {
  id: string;
  userId: string;
  blockId: string;
  title: string;
  description: string;
  priority: 'high' | 'medium' | 'low';
  status: 'pending' | 'in-progress' | 'completed';
  dueDate: string;
  completed: boolean;
  createdAt: string;
  updatedAt?: string;
}
```

## Восстановление доступа

### Процесс восстановления пароля

1. Пользователь нажимает "Забыли пароль?"
2. Вводит email
3. Система отправляет на email инструкции для восстановления
4. Пользователь получает ссылку/код для сброса пароля
5. Устанавливает новый пароль
6. Автоматически авторизуется

### Механизм восстановления данных

После авторизации:
1. Приложение проверяет локальное хранилище на наличие истории
2. Загружает данные пользователя с сервера
3. Синхронизирует локальные и серверные данные
4. Восстанавливает незавершенные диагностики (если есть)

## Личный кабинет

### Функционал
- Просмотр и редактирование профиля
- История всех диагностик
- Настройки уведомлений
- Управление подпиской (будущее)
- Выход из аккаунта

### Данные, отображаемые в личном кабинете
- Email пользователя
- ФИО (если указано)
- Дата регистрации
- История диагностик с возможностью фильтрации
- Статистика пройденных блоков
- Прогресс выполнения задач

## API Endpoints (планируемые)

### Авторизация
- `POST /auth/login` - вход в систему
- `POST /auth/register` - регистрация
- `POST /auth/reset-password` - запрос на восстановление пароля
- `POST /auth/reset-password/confirm` - подтверждение сброса пароля
- `POST /auth/logout` - выход из системы

### Пользователь
- `GET /user/profile` - получение профиля
- `PUT /user/profile` - обновление профиля
- `GET /user/history` - история диагностик
- `GET /user/statistics` - статистика пользователя

### Диагностика
- `POST /diagnosis/create` - создание новой диагностики
- `PUT /diagnosis/:id` - обновление диагностики
- `GET /diagnosis/:id` - получение диагностики
- `GET /diagnosis/history` - история всех диагностик

### Задачи
- `GET /tasks` - получение всех задач
- `POST /tasks` - создание задачи
- `PUT /tasks/:id` - обновление задачи
- `DELETE /tasks/:id` - удаление задачи

## Безопасность

### Токены
- JWT токены для авторизации
- Refresh токены для обновления сессии
- Автоматическое обновление токенов

### Данные
- Шифрование чувствительных данных
- HTTPS для всех API запросов
- Валидация данных на клиенте и сервере

## Синхронизация

### Автоматическая синхронизация
- При запуске приложения
- После завершения диагностики
- При изменении задач
- В фоновом режиме (будущее)

### Оффлайн режим
- Данные сохраняются локально
- При восстановлении соединения происходит синхронизация
- Разрешение конфликтов (последнее изменение побеждает)

